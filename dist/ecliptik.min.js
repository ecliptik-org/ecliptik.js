function Params(){this.sex=2*Math.random()-1,this.gender=2*Math.random()-1,this.orientation=2*Math.random()-1,this.sexChange=!1,this.acceptSexChange=!0,this.noOrientation=!1}function isSet(t,e){return(t&1<<e)>0?1:0}function combineBits(t,e){e.length;var n,r=0;for(n=0;n<e.length;n++)r|=isSet(t,e[n])<<n;return r/(.5*((1<<e.length)-1))-1}function shuffleBits(t,e){var n=0,r=(1<<e.length)-1,a=Math.round((t+1)*r*.5),i=0;for(i=0;i<e.length;i++)n|=isSet(a,i)<<e[i];return n}function base64AddPadding(t){return t+Array((4-t.length%4)%4+1).join("=")}$.fn.ecliptikSetup=function(t){0==$(this).find(".canvas").length&&$(this).append('<div class="canvas"></div>');var e=$(this).find(".canvas");e.find("svg").length&&e.find("svg").remove();var n=SVG(e[0]),r=$(this).width();n.size(r,r);var a=new Params;null==t&&(console.log("no params for ecliptik"),null!=(t=$(this).attr("ecliptik-params"))&&(t="#"===t.charAt(0)?t.replace("#",""):JSON.parse(t))),"string"==typeof t?a.fromUrlParam(t):a.copyFrom(t),paint(n,a.sex,a.gender,a.orientation,a.sexChange,a.acceptSexChange,a.noOrientation),e.attr("title",a.fullDescription())},$.fn.ecliptik=function(t){$(this).each(function(){$(this).ecliptikSetup(t)})},Params.prototype.copyFrom=function(t){null!=t&&(null!=t.sex&&(this.sex=t.sex),null!=t.gender&&(this.gender=t.gender),null!=t.orientation&&(this.orientation=t.orientation),null!=t.sexChange&&(this.sexChange=t.sexChange),null!=t.acceptSexChange&&(this.acceptSexChange=t.acceptSexChange),null!=t.noOrientation&&(this.noOrientation=t.noOrientation))},String.prototype.hexEncode=function(){var t,e="";for(t=0;t<this.length;t++)e+=this.charCodeAt(t).toString(16);return e},Params.prototype.fromUrlParam=function(t){if(t=base64AddPadding(t=t.replace(/_/g,"/").replace(/-/g,"+")),"undefined"==typeof window)var e=new Buffer(t,"base64"),n=parseInt(e.toString("hex"),16);else e=atob(t),n=parseInt(e.hexEncode(),16);0!=((n&=4294967295)>>31|n>>30)&&console.log("unknown url params version"),this.sex=combineBits(n,[8,4,21,17,12,19,5,29,10]),this.gender=combineBits(n,[27,1,25,6,3,14,15,22,26]),this.orientation=combineBits(n,[2,0,18,28,9,23,11,20,24]),this.sexChange=!!isSet(n,7),this.acceptSexChange=!!isSet(n,16),this.noOrientation=!!isSet(n,13)};var toBytesInt32=function(t){var e="";for(let n=3;n>=0;n--)e+=String.fromCharCode(t>>8*n&255);return e};function absPercentText(t,e,n){var r=t<0?e:n;return Math.round(50*Math.abs(t)+50)+"% "+r}function radiusFromSex(t,e){var n=1e4;if((t=Math.abs(t))>0&&(n=e/2,t<1)){var r=t*e/2;n=e*e/(8*r)+r/2}return n}function calcArrowTransform(t,e,n){var r=Math.asin(n/2/t),a=e*r,i=Math.sin(r)*t;return{angle:a,rotationCenter:{x:-Math.cos(r)*t,y:i}}}function drawArc(t,e,n,r,a,i){var o=0;r>=0&&(o=1),radius=radiusFromSex(r,a);var s={x:n.x,y:n.y};0==o&&(s.x+=r*a/2);var h=t.path("M0 0 A"+radius+" "+radius+" 0 0 "+o+" 0 "+a);h.fill("none").move(s.x,s.y),h.stroke({color:e,width:i,linecap:"square"})}function drawArrow(t,e,n,r,a,i,o,s,h){var c=radiusFromSex(r,o),l=calcArrowTransform(c,a,o);l.rotationCenter.x+=n.x,r<0&&(l.rotationCenter.x+=r*o/2),l.rotationCenter.y+=n.y;var u,p=.3*o,f=.4*p;if(1==i){var d=r<0^!h?.55:.45;u=t.path("M 0 0 H"+p+" M "+p*d+" "+f+" V"+-f)}else u=t.path("M 0 0 H"+p);r<0?(u.move(l.rotationCenter.x+c+r*o*.5-(h?0:p),l.rotationCenter.y+(i?-f:0)),l.angle=-l.angle,u.rotate(l.angle*(180/3.1415),l.rotationCenter.x+2*c-o/2*Math.abs(r),l.rotationCenter.y)):(u.move(l.rotationCenter.x+c-(h?p:0),l.rotationCenter.y+(i?-f:0)),u.rotate(l.angle*(180/3.1415),l.rotationCenter.x,l.rotationCenter.y)),u.fill("none"),u.stroke({color:e,width:s})}function paint(t,e,n,r,a,i,o){"undefined"==typeof window?t.viewbox(40,5,120,120):t.viewbox(40,10,120,110),t.clear();var s={x:100,y:30};drawArrow(t,"#000",s,e,n,a,70,5,!1),!1===o&&drawArrow(t,"#8C8C8C",s,e,r,i,70,5,!0),drawArc(t,"#000",s,e,70,5)}if(Params.prototype.toUrlParam=function(){var t=0;return t|=shuffleBits(this.sex,[8,4,21,17,12,19,5,29,10]),t|=shuffleBits(this.gender,[27,1,25,6,3,14,15,22,26]),t|=shuffleBits(this.orientation,[2,0,18,28,9,23,11,20,24]),t|=(1==this.sexChange?1:0)<<7,t|=(1==this.acceptSexChange?1:0)<<16,t|=(1==this.noOrientation?1:0)<<13,t=toBytesInt32(t),btoa(t).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")},Params.prototype.sexDescription=function(){var t=1==this.sexChange?" (had sex change)":"";return absPercentText(this.sex,"female","male")+t},Params.prototype.genderDescription=function(){return absPercentText(this.gender,"woman","man")},Params.prototype.orientationDescription=function(){if(this.noOrientation)return"none";var t=1==this.acceptSexChange?" (opt. sex change)":"";return absPercentText(this.orientation,"female","male")+t},Params.prototype.fullDescription=function(){var t="";return t+="Sex: "+this.sexDescription(),t+="\nGender: "+this.genderDescription(),t+="\nOrientation: "+this.orientationDescription()},module.exports=Params,"undefined"==typeof window){const t=require("./params.js");module.exports={paint:paint,params:t}}